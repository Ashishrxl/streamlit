name: Keep Streamlit App Awake

on:
  schedule:
    - cron: "0 * * * *"  # ‚è∞ Runs every hour
  workflow_dispatch:       # Allows manual run from GitHub Actions tab

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Streamlit app
        run: |
          echo "üîÑ Attempting to wake up Streamlit app..."
          
          URL="https://ashishraxaul.streamlit.app/"
          ATTEMPTS=3
          SLEEP_BETWEEN=60  # seconds

          for i in $(seq 1 $ATTEMPTS); do
            echo "‚û°Ô∏è  Attempt $i of $ATTEMPTS..."
            
            STATUS=$(curl -L -s -o /dev/null -w "%{http_code}" \
              -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64)" \
              "$URL")

            echo "Response code: $STATUS"

            if [ "$STATUS" -eq 200 ]; then
              echo "‚úÖ Streamlit app is awake and responding (HTTP 200)"
              exit 0
            else
              echo "‚ö†Ô∏è  Attempt $i failed (HTTP $STATUS)"
              if [ "$i" -lt "$ATTEMPTS" ]; then
                echo "‚è≥ Waiting $SLEEP_BETWEEN seconds before retry..."
                sleep $SLEEP_BETWEEN
              fi
            fi
          done

          echo "‚ùå All attempts failed ‚Äî Streamlit app may still be asleep or unreachable."
          exit 1